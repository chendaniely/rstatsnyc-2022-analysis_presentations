---
title: "Combining Analysis Work with Reports and Presentations"
subtitle: "What I Would Change About My Dissertation"

author: "[Daniel Chen](https://daniel.rbind.io/)"
date: "Thursday, June 9, 2022"
format:
  revealjs:
    footer: "[Daniel Chen](https://daniel.rbind.io/). @chendaniely. Using [Quarto](https://quarto.org/docs/presentations/revealjs/index.html). Slides: [https://github.com/chendaniely/2022-04-28-pycon2022-eduSummit-practice](https://github.com/chendaniely/2022-04-28-pycon2022-eduSummit-practice)"
    theme: ["custom.scss"]
    slide-number: c/t
    show-slide-number: all
    hash-type: number
---

## Munsee Lenape {.center}

<style>
div.footnote {
  font-size: 10px;
}
</style>

::: footnote

- https://native-land.ca/

:::

## Tutelo {.center}

<img src="img/intro/tutelo.png" alt="map of native lands in eastern USA with arrow pointed to Blacksburg/Roanoke Virginia area in the Tutelo Tribe" />

::: footnote

- https://native-land.ca/

:::

## Thank You

<blockquote class="twitter-tweet"><p lang="en" dir="ltr">Iâ€™m developing a presentation for <a href="https://twitter.com/seruff_?ref_src=twsrc%5Etfw">@seruff_</a> using <a href="https://twitter.com/quarto_pub?ref_src=twsrc%5Etfw">@quarto_pub</a> presentations.<br>I started to implement a similar theme as the xaringan <a href="https://twitter.com/RLadiesGlobal?ref_src=twsrc%5Etfw">@RLadiesGlobal</a> theme made by <a href="https://twitter.com/apreshill?ref_src=twsrc%5Etfw">@apreshill</a> !<br>If anyone wants to help to improve it, It would be awesome ðŸ’œ <a href="https://twitter.com/hashtag/rladies?src=hash&amp;ref_src=twsrc%5Etfw">#rladies</a> <a href="https://twitter.com/hashtag/RStats?src=hash&amp;ref_src=twsrc%5Etfw">#RStats</a> <a href="https://t.co/xps1v49Ku4">https://t.co/xps1v49Ku4</a> <a href="https://t.co/sK9d3X3unE">pic.twitter.com/sK9d3X3unE</a></p>&mdash; Beatriz Milz (@BeaMilz) <a href="https://twitter.com/BeaMilz/status/1515327145471578120?ref_src=twsrc%5Etfw">April 16, 2022</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

## I Finally Graduated...
:::::: columns
::: {.column width="50%"}
- RStatsNYC Started: 2015
- Daniel Started Gradschool: 2015
:::

::: {.column width="50%"}
```{r}
knitr::include_graphics("img/intro/dan_anne-graduation.jpg")
```
:::
::::::


## Daniel Chen, PhD, MPH {.center}

:::::: columns
::: {.column width="40%"}
<center>

<a href='mailto:chendaniely@gmail.com'><i class="far fa-envelope"></i></a>
<a href='https://twitter.com/chendaniely'><i class="fab fa-twitter"></i>
<a href='https://github.com/chendaniely'><i class="fab fa-github"></i></a>
<a href='https://twitch.tv/chendaniely'><i class="fab fa-twitch"></i></a>
@chendaniely

<img src="img/intro/foto.jpeg" alt="Daniel Chen" style="border-radius: 50%; max-width: 70%;"/>

</center>
:::

::: {.column width="60%"}
- Postdoctoral Research and Teaching Fellow, University of British Columbia

- Data Science Educator, RStudio, PBC ([RStudio Academy](https://www.rstudio.com/academy/))

- Data Scientist, [Lander Analytics](https://www.landeranalytics.com/)

- Author, [Pandas for Everyone](https://www.pearson.com/us/higher-education/program/Chen-Pandas-for-Everyone-Python-Data-Analysis/PGM335102.html)

- Alumni
    - The Carpentries
:::
::::::

# Combining Analysis Work with Reports and Presentations

## I talk about this a lot...

- [Building Reproducible and Replicable Projects](https://www.youtube.com/watch?v=t-vY9FeIIMk)
- [Structuring Your Data Science Projects](https://www.youtube.com/watch?v=UQHz38s3DyA
)
- [Doing Data Science](https://www.youtube.com/watch?v=1VcuGSjPHWU)

... and teach it.

- Working around + with real-world constraints
- Incremental improvement
    - [JD Long, Empathy in action: Building community of practice for analytics ](https://www.youtube.com/watch?v=CjNOSrfQiAY)

## Back in 2019...

[Building Reproducible and Replicable Projects](https://www.youtube.com/watch?v=t-vY9FeIIMk)

- **reproducibility** - the extent to which consistent results are obtained when an experiment is repeated

- **replicability** - the ability of a scientific experiment or trial to be repeated to obtain a consistent result

## Important for scale

- Build more features
- Move to larger/cloud compute
- Collaborate with other people

# Analysis Project Structure

## Folder Setup

```{r}
knitr::include_graphics("img/noble-2009.png")
```

## Folder Setup

```{r}
knitr::include_graphics("img/noble_dir_structure.png")
```

## Dissertation Analysis

Repo: https://github.com/chendaniely/dissertation-analysis

TODO: look into `fs::dir_tree()`

```
dissertation-analysis/
    |
    |- R
    |   |-
    |
    |- analysis
    |   |-
    |
    |- build
    |- data/original
    |- output]
    |- renv
    |
    |- 
```
 
## Naming Things

:::::: columns
::: {.column width="50%"}
- - [Karl Broman, "Steps toward reproducible research"](https://www.youtube.com/watch?v=rNQ-RlG3JnQ)
- [Jenny Bryan: Naming Things](http://www2.stat.duke.edu/~rcs46/lectures_2015/01-markdown-git/slides/naming-slides/naming-slides.pdf)

<blockquote class="twitter-tweet"><p lang="en" dir="ltr">The Golden Rule of Naming Files and Other Things:<br>Thou shalt get only as creative with names as thy own skill with regular expressions.</p>&mdash; Jenny Bryan (@JennyBryan) <a href="https://twitter.com/JennyBryan/status/807805087544328192?ref_src=twsrc%5Etfw">December 11, 2016</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script> 
:::

::: {.column width="50%"}

TODO: TOC of major topics in Jenny's talk

:::
::::::



## Project File + Working Directories

TODO: image of creating project files in RStudio

- https://rstats.wtf/project-oriented-workflow.html
- https://rstats.wtf/safe-paths.html

## Only commiting the "final" artifacts

- So the reports and presentations can always refer to things I need
- This is the stuff that goes into your `output` or `results` folder
    - Other projects / repositories have a consistent place to look for latest artifacts (e.g., images, tables, etc)
    - `data/final`: for final datasets

# Analysis Code Development

## Testing..

- Maybe this is controversial:

- I didn't write unit tests for my actual functions
    - this wasn't that practical
- Instead, I wrote code to verify my data
    - `stopifnot`, `{testthat}`, `{checkmate}`

## Pinning your package versions

- `renv`
- `renv::init()` to create the `renv.lock` file
- `renv::snapshot()`: to update the lockfile
- `renv::restore()`: to restore the packages

## What I would Improve

- Actually use the `R` package structure
- I know I was asking to get my computer set on fire!
- But the structure was there

```R
source(here("./R/remove_identifiers.R"))
source(here("./R/remove_invalid_rows.R"))
source(here("./R/remove_duplicate_ids.R"))
source(here("./analysis/010-qualtrics/survey_search_names.R"))
```

## DESCRIPTION to fake a package

```
Type: Project
Package: dissertation-analysis
Title: Dissertation Analysis
Version: 0.0.0.9000
Authors@R: 
    person("Daniel", "Chen",
           "chendaniely@gmail.com",
           role = c("aut", "cre"))
Description: Dissertation Analysis
Imports:
    tidyverse,
    qualtRics   
Suggests: 
    testthat (>= 3.0.0)
Config/testthat/edition: 3
Encoding: UTF-8
LazyData: true
```

### Load Your Functions

```r
pkgload::load_all()
```

## Rig to manage Multiple R versions

- Already built-in to windows
- RSwitch isn't maintained
- Linux now has _something_

https://github.com/r-lib/rig

## My Build Enviornemnt

What I did:

- Write an R script that runs all my parameterized reports with differnt `params`
- All I had were R scripts
- Not the worst thing in the world, I didn't mind re-running the entire pipeline

## Improving the Build Enviornment

What I would change + look into

- `{targets}`: https://docs.ropensci.org/targets/

```{r}
knitr::include_graphics("img/targets.png")
```

- Could also have used `Make` but I needed to do parameter sweeps of files.
    - [Building Reproducible and Replicable Projects](https://www.youtube.com/watch?v=t-vY9FeIIMk)

# Other project repositories

## Don't keep everything in a mono repo

1. ds4biomed book: https://github.com/chendaniely/ds4biomed/
1. IRB: https://github.com/chendaniely/dissertation-irb/
1. Initial Plan: https://github.com/chendaniely/dissertation-plan
1. Presentations: https://github.com/chendaniely/dissertation-presentations
1. Prelims: https://github.com/chendaniely/dissertation-prelim
1. Submitted Paper: https://github.com/chendaniely/dissertation-paper-03-assessmet
1. Actual Dissertation (EDT): https://github.com/chendaniely/dissertation-edt
1. etc...

## Bookdown

- ds4biomed book: https://github.com/chendaniely/ds4biomed/
- Initial Plan: https://github.com/chendaniely/dissertation-plan
- Prelims: https://github.com/chendaniely/dissertation-prelim
    - Also the submitted word document

## Mixed + Non-reproducible formats

- IRB: https://github.com/chendaniely/dissertation-irb/
- Presentations: https://github.com/chendaniely/dissertation-presentations

## Collaborating with + without Git

Dissertation EDT: https://github.com/chendaniely/dissertation-edt

Workflow:

- Git repo + Local writing/Compiling 
- Collaboration / Feedback via Overleaf + git integration
- Pull / Push to sync changes
- Still had to manually move over artifacts (overleaf limitation)

## Use Child Documents

:::::: columns
::: {.column width="25%"}
- LaTeX
- RMarkdown
- Quarto
:::

::: {.column width="75%"}
Child doc latex example
:::
::::::

## Useing a Build file

- Do not forget what commands I need to run
- Especially compiling latex biblography

```
LATEX=xelatex
BIBTEX=bibtex
STEM=main

all : commands

## commands   : show all commands.
commands :
	@grep -E '^##' Makefile | sed -e 's/## //g'

## counts      : get tex word counts
counts :
	find . -type f -name "*.tex" | xargs texcount 2>/dev/null | grep -w "Words in text:" | cut -d : -f 2 | awk '{Total=Total+$$1} END {print "Total is: " Total}'

## pdf        : re-generate PDF
pdf :
	${LATEX} -synctex=1 -interaction=nonstopmode ${STEM}
#	# nomenclature/abbreviations
	makeindex ${STEM}.nlo -s nomencl.ist -o ${STEM}.nls
#	${BIBTEX} ${STEM}
	${LATEX} -synctex=1 -interaction=nonstopmode ${STEM}
	${LATEX} -synctex=1 -interaction=nonstopmode ${STEM}
```

https://github.com/chendaniely/dissertation-edt/blob/main/Makefile

## What I would change

- Quarto
- knitr + LaTex Rnw files
- Challenge: Still need to keep the original LaTeX Source
    - even though Overleaf can do basic R computation

## LaTeX bibs still confuse me

TODO:

- There are 2 ways
- link to the overleaf docs

# Keeping Everything Together

## All these seprate repositories

- Keep them together
- Sometimes I want to reference things with relative paths
- Maybe an overall project to tie things together

## Git Submodules

- "Nest" git repositioes

- https://github.com/chendaniely/dissertation

## Mental Model

- Each sub repo is a regular git repositoyry
    - add / commmit / push / pull
    - is exaactly the same
- Everytime you push/pusll/commit from the submodule
    - go back to the main parent repo
    - update the commit references with add commit push
- In the main repo, it's really just tracking the latest trackedc commit
    - it doesn't automatically keep up with `main`

# Git Submodules

## How to add a submodule

## how to pull

## making changes

# Experiments

## Running SHiny experiments

- https://github.com/chendaniely/dissertation-phase4_exercises

## What I would change

- `{shinysurveys}`: https://cran.r-project.org/web/packages/shinysurveys/index.html

- https://www.rstudio.com/resources/rstudioglobal-2021/designing-randomized-studies-using-shiny/

- A better way to capture learnr submissions

- Learnr + gradethis isn't really made for this kind of work?

<!-- inicio font awesome -->

```{=html}
<script src="https://kit.fontawesome.com/1f72d6921a.js" crossorigin="anonymous"></script>
```
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jpswalsh/academicons@1/css/academicons.min.css"> <!-- final font awesome -->

## What I would change

1. DESCRIPTION to fake a package
1. Rig to manage Multiple R versions
1. `{targets}` + `Makefile`: Improving the Build Enviornment
1. Quarto
1. `{shinysurveys}`: to do better block randomization

# Thanks!
