---
title: "Combining Analysis Work with Reports and Presentations"
subtitle: "What I Would Change About My Dissertation"

author: "[Daniel Chen](https://daniel.rbind.io/)"
date: "Thursday, June 9, 2022"
format:
  revealjs:
    footer: "[Daniel Chen](https://daniel.rbind.io/). @chendaniely. Using [Quarto](https://quarto.org/docs/presentations/revealjs/index.html). Slides: [https://github.com/chendaniely/rstatsnyc-2022-analysis_presentations](https://github.com/chendaniely/rstatsnyc-2022-analysis_presentations)"
    theme: ["custom.scss"]
    slide-number: c/t
    show-slide-number: all
    hash-type: number
---

## Munsee Lenape {.center}

<style>
div.footnote {
  font-size: 10px;
}
</style>

<img src="img/intro/munsee_lenape.png" alt="map of native lands in NYC Manhattan area showing the munsee Lenape and Wappinger Tribes." />

::: footnote

- https://native-land.ca/

:::

## Tutelo {.center}

<img src="img/intro/tutelo.png" alt="map of native lands in eastern USA with arrow pointed to Blacksburg/Roanoke Virginia area in the Tutelo Tribe" />

::: footnote

- https://native-land.ca/

:::

## Thank You

<blockquote class="twitter-tweet"><p lang="en" dir="ltr">Iâ€™m developing a presentation for <a href="https://twitter.com/seruff_?ref_src=twsrc%5Etfw">@seruff_</a> using <a href="https://twitter.com/quarto_pub?ref_src=twsrc%5Etfw">@quarto_pub</a> presentations.<br>I started to implement a similar theme as the xaringan <a href="https://twitter.com/RLadiesGlobal?ref_src=twsrc%5Etfw">@RLadiesGlobal</a> theme made by <a href="https://twitter.com/apreshill?ref_src=twsrc%5Etfw">@apreshill</a> !<br>If anyone wants to help to improve it, It would be awesome ðŸ’œ <a href="https://twitter.com/hashtag/rladies?src=hash&amp;ref_src=twsrc%5Etfw">#rladies</a> <a href="https://twitter.com/hashtag/RStats?src=hash&amp;ref_src=twsrc%5Etfw">#RStats</a> <a href="https://t.co/xps1v49Ku4">https://t.co/xps1v49Ku4</a> <a href="https://t.co/sK9d3X3unE">pic.twitter.com/sK9d3X3unE</a></p>&mdash; Beatriz Milz (@BeaMilz) <a href="https://twitter.com/BeaMilz/status/1515327145471578120?ref_src=twsrc%5Etfw">April 16, 2022</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

## I Finally Graduated...

:::::: columns
::: {.column width="50%"}
Start Times:

- RStatsNYC: 2015

<iframe width="560" height="315" src="https://www.youtube.com/embed/oPCIqDagGSk" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

- Grad School: 2015
:::

::: {.column width="50%"}
```{r}
knitr::include_graphics("img/intro/dan_anne-graduation.jpg")
```
:::
::::::

## Daniel Chen, PhD, MPH {.center}

:::::: columns
::: {.column width="40%"}
<center>

<a href='mailto:chendaniely@gmail.com'><i class="far fa-envelope"></i></a>
<a href='https://twitter.com/chendaniely'><i class="fab fa-twitter"></i>
<a href='https://github.com/chendaniely'><i class="fab fa-github"></i></a>
<a href='https://twitch.tv/chendaniely'><i class="fab fa-twitch"></i></a>
@chendaniely

<img src="img/intro/foto.jpeg" alt="Daniel Chen" style="border-radius: 50%; max-width: 70%;"/>

</center>
:::

::: {.column width="60%"}
- Postdoctoral Research and Teaching Fellow, University of British Columbia

- Data Science Educator, RStudio, PBC ([RStudio Academy](https://www.rstudio.com/academy/))

- Data Scientist, [Lander Analytics](https://www.landeranalytics.com/)

- Author, [Pandas for Everyone](https://www.pearson.com/us/higher-education/program/Chen-Pandas-for-Everyone-Python-Data-Analysis/PGM335102.html)

- Alumni
    - The Carpentries
:::
::::::

# Combining Analysis Work with Reports and Presentations

## I talk about this a lot...

- [Building Reproducible and Replicable Projects](https://www.youtube.com/watch?v=t-vY9FeIIMk)
- [Structuring Your Data Science Projects](https://www.youtube.com/watch?v=UQHz38s3DyA)
- [Doing Data Science](https://www.youtube.com/watch?v=1VcuGSjPHWU)

### ... and teach it.

### Constrants + Incremental Improvements

- Working with real-world constraints
- Incremental improvement
    - [JD Long, Empathy in action: Building community of practice for analytics ](https://www.youtube.com/watch?v=CjNOSrfQiAY)
- Time-box your learning

## Back in 2019...

[Building Reproducible and Replicable Projects](https://www.youtube.com/watch?v=t-vY9FeIIMk)

- **reproducibility** - the extent to which consistent results are obtained when an experiment is repeated

- **replicability** - the ability of a scientific experiment or trial to be repeated to obtain a consistent result

### Important for scale

- Build more features
- Move to larger/cloud compute
- Collaborate with other people

# Analysis Project Structure

## Folder Setup

```{r}
knitr::include_graphics("img/noble-2009.png")
```

## Folder Setup

```{r}
knitr::include_graphics("img/noble_dir_structure.png")
```

## Dissertation Analysis

Repo: [https://github.com/chendaniely/dissertation-analysis](https://github.com/chendaniely/dissertation-analysis)

:::::: columns
::: {.column width="50%"}
Project/Packaging
```
â”œâ”€â”€ LICENSE
â”œâ”€â”€ R
â”‚   â”œâ”€â”€ get_survey.R
â”‚   â”œâ”€â”€ gg_plot_dendro.R
â”‚   â”œâ”€â”€ likert.R
â”‚   â”œâ”€â”€ offset_number.R
â”‚   â”œâ”€â”€ plot_question_bar.R
â”‚   â”œâ”€â”€ question_str_to_int.R
â”‚   â”œâ”€â”€ recode_occupation.R
â”‚   â”œâ”€â”€ remove_duplicate_ids.R
â”‚   â”œâ”€â”€ remove_identifiers.R
â”‚   â”œâ”€â”€ remove_invalid_rows.R
â”‚   â”œâ”€â”€ save_analysis_edt.R
â”‚   â”œâ”€â”€ strip_html.R
â”‚   â””â”€â”€ survey_q_multi_choice_multi_answer.R
â”œâ”€â”€ README.md
â”œâ”€â”€ dissertation-analysis.Rproj
â”œâ”€â”€ renv
â”‚   â”œâ”€â”€ activate.R
â”‚   â””â”€â”€ settings.dcf
â””â”€â”€ renv.lock
```
:::

::: {.column width="50%"}
Analysis
```
â”œâ”€â”€ analysis
â”‚   â”œâ”€â”€ 010-qualtrics
â”‚   â”œâ”€â”€ 020-validation
â”‚   â”œâ”€â”€ 030-persona
â”‚   â”œâ”€â”€ 040-workshop
â”‚   â”œâ”€â”€ 050-exercises
â”‚   â””â”€â”€ emails
â”œâ”€â”€ build
â”‚   â”œâ”€â”€ 00-clean.R
â”‚   â”œâ”€â”€ 01-download_process_qualtrics.R
â”‚   â””â”€â”€ 10-persona.R
â”œâ”€â”€ data
â”‚   â””â”€â”€ original
â”œâ”€â”€ output
â”‚   â”œâ”€â”€ exercises
â”‚   â”œâ”€â”€ persona
â”‚   â”œâ”€â”€ survey
â”‚   â””â”€â”€ validation
```
:::
::::::

 
## Naming Things

:::::: columns
::: {.column width="50%"}
- [Karl Broman, "Steps toward reproducible research"](https://www.youtube.com/watch?v=rNQ-RlG3JnQ)
- [Jenny Bryan: Naming Things](http://www2.stat.duke.edu/~rcs46/lectures_2015/01-markdown-git/slides/naming-slides/naming-slides.pdf)

<blockquote class="twitter-tweet"><p lang="en" dir="ltr">The Golden Rule of Naming Files and Other Things:<br>Thou shalt get only as creative with names as thy own skill with regular expressions.</p>&mdash; Jenny Bryan (@JennyBryan) <a href="https://twitter.com/JennyBryan/status/807805087544328192?ref_src=twsrc%5Etfw">December 11, 2016</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script> 
:::

::: {.column width="50%"}

1. Machine readable
    - Deliberate user of `_` and `-`
2. Human readable
    - contains info on content
3. Plays well with default ordering
    - ISO 8601
    - Left pad with `0`

```
> fs::dir_tree("analysis/020-validation/")
analysis/020-validation/
â”œâ”€â”€ 010-prep_survey_questions.R
â”œâ”€â”€ 020-005-fa.Rmd
â”œâ”€â”€ 020-010-cronbah.Rmd
â””â”€â”€ 030-cart.Rmd
```

:::
::::::



## Project File

- https://rstats.wtf/project-oriented-workflow.html

```{r}
knitr::include_graphics("img/rstudio-new_project-01.PNG")
```

## Working Directories

- https://rstats.wtf/safe-paths.html

```{r}
knitr::include_graphics("img/here.png")
```

## Only commiting the "final" artifacts

- So the reports and presentations can always refer to things I need
- This is the stuff that goes into your `output` or `results` folder
    - Other projects / repositories have a consistent place to look for latest artifacts (e.g., images, tables, etc)
    - `data/final`: for final datasets

```
> fs::dir_tree("output/", recurse=1)
output/
â”œâ”€â”€ exercises
â”‚   â”œâ”€â”€ score_prop-ex-treatment-facet_pre-combine_treatments.png
â”‚   â”œâ”€â”€ score_prop-ex-treatment-facet_pre.png
â”‚   â”œâ”€â”€ score_prop-ex-treatment-no_facet-combine_treatments.png
â”‚   â”œâ”€â”€ score_prop-ex-treatment-no_facet.png
â”‚   â”œâ”€â”€ score_prop-ex-treatment-pre100.png
â”‚   â”œâ”€â”€ score_prop-ex-treatment.png
â”‚   â””â”€â”€ time_to_complete-ex-treatment-no_facet-combine_treatments.png
â”œâ”€â”€ persona
â”‚   â”œâ”€â”€ efa_eigen_scree.png
â”‚   â”œâ”€â”€ efa_eigen_scree_good.png
â”‚   â”œâ”€â”€ efa_item_correlations.png
â”‚   â”œâ”€â”€ likert_only
â”‚   â”œâ”€â”€ survey_likert
â”‚   â””â”€â”€ survey_only
â”œâ”€â”€ survey
â”‚   â”œâ”€â”€ 01-self_assessment
â”‚   â”œâ”€â”€ 02-pre_workshop
â”‚   â”œâ”€â”€ 03-post_workshop
â”‚   â””â”€â”€ 050-logitudinal
â””â”€â”€ validation
    â””â”€â”€ 020-010-cronbah-survey_likert.html
```

# Analysis Code Development

## Testing...

- Controversial: I didn't write unit tests for my actual functions
    - this wasn't that practical
- Instead, I wrote code to verify my data
    - `stopifnot`, `{testthat}`, `{checkmate}`
- Research Software Engineers
    - This is an analysis project, not software

```{r, echo=TRUE}
x <- 42
stopifnot(x == 42)
```

<br />

```{r, echo=TRUE, error=TRUE}
stopifnot(x == 525600)
```


## Pinning your package versions

- `renv`
- `renv::init()` to create the `renv.lock` file
- `renv::snapshot()`: to update the lockfile
- `renv::restore()`: to restore the packages

:::::: columns

:::{.column width="50%"}
```
â”œâ”€â”€ renv
â”‚   â”œâ”€â”€ activate.R
â”‚   â””â”€â”€ settings.dcf
â””â”€â”€ renv.lock
```
:::

:::{.column width="50%"}
```
    "tidyverse": {
      "Package": "tidyverse",
      "Version": "1.3.1",
      "Source": "Repository",
      "Repository": "CRAN",
      "Hash": "fc4c72b6ae9bb283416bd59a3303bbab"
    },
```
:::
::::::

## What I would Improve

- Actually use the `R` package structure
- I know I was asking to get my computer set on fire!
- But the structure was there

```R
source(here("./R/remove_identifiers.R"))
source(here("./R/remove_invalid_rows.R"))
source(here("./R/remove_duplicate_ids.R"))
source(here("./analysis/010-qualtrics/survey_search_names.R"))
```

## DESCRIPTION to fake a package

```
Type: Project
Package: dissertation-analysis
Title: Dissertation Analysis
Version: 0.0.0.9000
Authors@R: 
    person("Daniel", "Chen",
           "chendaniely@gmail.com",
           role = c("aut", "cre"))
Description: Dissertation Analysis
Imports:
    tidyverse,
    qualtRics   
Suggests: 
    testthat (>= 3.0.0)
Config/testthat/edition: 3
Encoding: UTF-8
LazyData: true
```

### Load Your Functions

```r
pkgload::load_all()
```

## Rig to manage Multiple R versions

[https://github.com/r-lib/rig](https://github.com/r-lib/rig)

- Already built-in to windows
- RSwitch isn't maintained
- Linux now has _something_

## My Build Enviornemnt

What I did:

- Write an R script that runs all my parameterized reports with different `params`
- All I had were R scripts
- Not the worst thing in the world, I didn't mind re-running the entire pipeline

## Improving the Build Enviornment

What I would change + look into

- `{targets}`: https://docs.ropensci.org/targets/

```{r}
knitr::include_graphics("img/targets.png")
```

- Could also have used `Make` but I needed to do parameter sweeps of files.
    - [Building Reproducible and Replicable Projects](https://www.youtube.com/watch?v=t-vY9FeIIMk)

# Other project repositories

## Don't keep everything in a mono repo

1. ds4biomed book: https://github.com/chendaniely/ds4biomed/
1. IRB: https://github.com/chendaniely/dissertation-irb/
1. Initial Plan: https://github.com/chendaniely/dissertation-plan
1. Presentations: https://github.com/chendaniely/dissertation-presentations
1. Prelims: https://github.com/chendaniely/dissertation-prelim
1. Submitted Paper: https://github.com/chendaniely/dissertation-paper-03-assessment
1. Actual Dissertation (EDT): https://github.com/chendaniely/dissertation-edt
1. etc...

## Bookdown

- ds4biomed book: https://github.com/chendaniely/ds4biomed/
- Initial Plan: https://github.com/chendaniely/dissertation-plan
- Prelims: https://github.com/chendaniely/dissertation-prelim
    - Also the submitted word document

![](img/Snake_title_cropped.png)

## Mixed + Non-reproducible formats

- IRB: https://github.com/chendaniely/dissertation-irb/
- Presentations: https://github.com/chendaniely/dissertation-presentations

## Collaborating with + without Git

Dissertation EDT: https://github.com/chendaniely/dissertation-edt

Workflow:

- Git repo + Local writing/Compiling 
- Collaboration / Feedback via Overleaf + git integration
- Pull / Push to sync changes
- Still had to manually move over artifacts (overleaf limitation)

## Use Child Documents

:::::: columns
::: {.column width="40%"}
- LaTeX
- RMarkdown
- Quarto

`main.tex`:

```latex
\usepackage{subfiles}

\begin{document}
    \chapter{Introduction}
        \label{ch:introduction}
        \subfile{010-intro/010-intro}
\end{document}
```
:::

::: {.column width="60%"}

`010-intro/010-intro.tex`:
```latex
\documentclass[../main.tex]{subfiles}
\begin{document}

    \subfile{010-010-intro}

    \section{History of Data Science}
        \label{se:intro-ds-history}

        Statistics, data science, and computational programming education
\end{document}
```

`010-intro/010-010-intro.tex`:
```latex
\documentclass[010-intro.tex]{subfiles}
\begin{document}

This dissertation describes the current state of education and pedagogy in the field of data science
and explores ways to improve data science education in a specific sub-field, biomedical sciences.
...
\end{document}
```
:::
::::::

[https://github.com/chendaniely/dissertation-edt/blob/main/main.tex](https://github.com/chendaniely/dissertation-edt/blob/main/main.tex)

## Using a Build file

- Do not forget what commands I need to run
- Especially compiling latex bibliography

```
LATEX=xelatex
BIBTEX=bibtex
STEM=main

all : commands

## commands   : show all commands.
commands :
	@grep -E '^##' Makefile | sed -e 's/## //g'

## counts      : get tex word counts
counts :
	find . -type f -name "*.tex" | xargs texcount 2>/dev/null | grep -w "Words in text:" | cut -d : -f 2 | awk '{Total=Total+$$1} END {print "Total is: " Total}'

## pdf        : re-generate PDF
pdf :
	${LATEX} -synctex=1 -interaction=nonstopmode ${STEM}
#	# nomenclature/abbreviations
	makeindex ${STEM}.nlo -s nomencl.ist -o ${STEM}.nls
#	${BIBTEX} ${STEM}
	${LATEX} -synctex=1 -interaction=nonstopmode ${STEM}
	${LATEX} -synctex=1 -interaction=nonstopmode ${STEM}
```

[https://github.com/chendaniely/dissertation-edt/blob/main/Makefile](https://github.com/chendaniely/dissertation-edt/blob/main/Makefile)

## Make commands

```
% make
commands    : show all commands.
counts      : get tex word counts
pdf         : re-generate PDF
clean       : clean up junk files.
sync        : sync overleaf -> local -> GitHub
push        : push local to GitHub and Overleaf
fetch       : fetch remotes origin + leaf
```

## What I would change

- Quarto
- knitr + LaTex Rnw files
- Challenge: Still need to keep the original LaTeX Source
    - even though Overleaf can do basic R computation

# Keeping Everything Together

## All these seprate repositories

- Keep them together
- Sometimes I want to reference things with relative paths
- Maybe an overall project to tie things together

## Git Submodules

[https://github.com/chendaniely/dissertation](https://github.com/chendaniely/dissertation)

- "Nest" git repository

:::::: columns
:::{.column width="50%"}
```
> fs::dir_tree(".", recurse=1)
.
â”œâ”€â”€ 010-intro.md
â”œâ”€â”€ README.md
â”œâ”€â”€ dissertation.Rproj
â””â”€â”€ submodules
    â”œâ”€â”€ dissertation-analysis
    â”œâ”€â”€ dissertation-edt
    â”œâ”€â”€ dissertation-irb
    â”œâ”€â”€ dissertation-paper-03-assessment
    â”œâ”€â”€ dissertation-phase4_exercises
    â”œâ”€â”€ dissertation-plan
    â”œâ”€â”€ dissertation-prelim
    â”œâ”€â”€ dissertation-presentations
    â”œâ”€â”€ dissertation-thank_you
    â””â”€â”€ ds4biomed
```
:::

:::{.column width="50%"}
```
> fs::dir_tree(".", recurse=2)
.
â”œâ”€â”€ 010-intro.md
â”œâ”€â”€ README.md
â”œâ”€â”€ dissertation.Rproj
â””â”€â”€ submodules
    â”œâ”€â”€ dissertation-analysis
    â”‚   â”œâ”€â”€ LICENSE
    â”‚   â”œâ”€â”€ R
    â”‚   â”œâ”€â”€ README.md
    â”‚   â”œâ”€â”€ analysis
    â”‚   â”œâ”€â”€ build
    â”‚   â”œâ”€â”€ data
    â”‚   â”œâ”€â”€ dissertation-analysis.Rproj
    â”‚   â”œâ”€â”€ output
    â”‚   â”œâ”€â”€ renv
    â”‚   â””â”€â”€ renv.lock
    â”œâ”€â”€ dissertation-edt
    â”‚   â”œâ”€â”€ 005-frontmatter
    â”‚   â”œâ”€â”€ 010-intro
    â”‚   â”œâ”€â”€ 020-persona_validation
    â”‚   â”œâ”€â”€ 030-workshop
    â”‚   â”œâ”€â”€ 040-assessment
    â”‚   â”œâ”€â”€ 050-conclusion
    â”‚   â”œâ”€â”€ 090-appendix
    â”‚   â”œâ”€â”€ Chen_DY_D_2021.pdf
    â”‚   â”œâ”€â”€ LICENSE
    â”‚   â”œâ”€â”€ Makefile
    â”‚   â”œâ”€â”€ README.md
    â”‚   â”œâ”€â”€ VTthesis.cls
    â”‚   â”œâ”€â”€ bib.bib
    â”‚   â”œâ”€â”€ figs
    â”‚   â”œâ”€â”€ main.tex
    â”‚   â””â”€â”€ snippets.txt
```
:::
::::::

## Git Submodules: Mental Model

- Each sub repo is a regular git repository
    - `add` / `commmit` / `push` / `pull`
    - is exactly the same
- Every time you `push`/`pull`/`commit` from the submodule
    - go back to the main parent repo
    - update the commit references with `add`, `commit`, and `push`
- In the main repo, it's really just tracking the latest tracked commit
    - it doesn't automatically keep up with `main`

## Parent repo only tracking the commit

```{r}
knitr::include_graphics("img/git-submodule-example.png")
```


# Experiments

## Running Shiny experiments

[https://github.com/chendaniely/dissertation-phase4_exercises](https://github.com/chendaniely/dissertation-phase4_exercises)

### What I would change

- `{shinysurveys}`: https://cran.r-project.org/web/packages/shinysurveys/index.html

- https://www.rstudio.com/resources/rstudioglobal-2021/designing-randomized-studies-using-shiny/

- A better way to capture learnr submissions

- Learnr + gradethis isn't really made for this kind of work?

<!-- inicio font awesome -->

```{=html}
<script src="https://kit.fontawesome.com/1f72d6921a.js" crossorigin="anonymous"></script>
```
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jpswalsh/academicons@1/css/academicons.min.css"> <!-- final font awesome -->

## In Sum: What I would change

1. DESCRIPTION to fake a package
1. Rig to manage Multiple R versions
1. `{targets}` + `Makefile`: Improving the Build Environment
1. Quarto for my websites, books, and presentations
    - maybe even the final EDT?
1. `{shinysurveys}`: to do better block randomization

# Thanks!

<!--

## LaTeX bibs still confuse me

TODO:

- There are 2 ways
- link to the overleaf docs


--->
